<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Management App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Auth Screen Container -->
    <div id="authScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <!-- Login Screen -->
        <div id="loginScreen" class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-car text-blue-600 text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Car Management</h1>
                <p class="text-gray-600 mt-2">ระบบจัดการรถยนต์</p>
            </div>
            
            <!-- Social Login Buttons -->
            <div class="space-y-3 mb-6">
                <button id="googleLoginBtn" class="w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition-all duration-200 flex items-center justify-center space-x-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>เข้าสู่ระบบด้วย Google</span>
                </button>
                
                <button id="lineLoginBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 flex items-center justify-center space-x-3">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                    </svg>
                    <span>เข้าสู่ระบบด้วย LINE</span>
                </button>
            </div>
            
            <div class="relative mb-6">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-300"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-white text-gray-500">หรือ</span>
                </div>
            </div>

            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="loginUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="กรอกชื่อผู้ใช้">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">รหัสผ่าน</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="กรอกรหัสผ่าน">
                </div>
                
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-medium hover:shadow-lg transition-all duration-200">
                    เข้าสู่ระบบ
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600">ยังไม่มีบัญชี?</p>
                <button id="showRegisterBtn" class="text-blue-600 hover:text-blue-800 font-medium mt-2">
                    สมัครสมาชิก
                </button>
            </div>
        </div>

        <!-- Register Screen -->
        <div id="registerScreen" class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md hidden">
            <div class="text-center mb-8">
                <div class="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-plus text-green-600 text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">สมัครสมาชิก</h1>
                <p class="text-gray-600 mt-2">สร้างบัญชีใหม่</p>
            </div>
            
            <!-- Social Register Buttons -->
            <div class="space-y-3 mb-6">
                <button id="googleRegisterBtn" class="w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition-all duration-200 flex items-center justify-center space-x-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>สมัครด้วย Google</span>
                </button>
                
                <button id="lineRegisterBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 flex items-center justify-center space-x-3">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                    </svg>
                    <span>สมัครด้วย LINE</span>
                </button>
            </div>
            
            <div class="relative mb-6">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-300"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-white text-gray-500">หรือ</span>
                </div>
            </div>

            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อ-นามสกุล</label>
                    <input type="text" id="fullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="กรอกชื่อ-นามสกุล" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="registerUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="กรอกชื่อผู้ใช้" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">อีเมล</label>
                    <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="กรอกอีเมล" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                    <input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="กรอกเบอร์โทรศัพท์" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">รหัสผ่าน</label>
                    <input type="password" id="registerPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="กรอกรหัสผ่าน" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ยืนยันรหัสผ่าน</label>
                    <input type="password" id="confirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="ยืนยันรหัสผ่าน" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ตำแหน่ง</label>
                    <select id="registerRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                        <option value="">เลือกตำแหน่ง</option>
                        <option value="admin">ผู้ดูแลระบบ</option>
                        <option value="manager">ผู้จัดการ</option>
                        <option value="driver">คนขับรถ</option>
                        <option value="user">ผู้ใช้ทั่วไป</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">แผนก/หน่วยงาน</label>
                    <input type="text" id="department" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="กรอกแผนก/หน่วยงาน">
                </div>
                
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium hover:shadow-lg transition-all duration-200">
                    สมัครสมาชิก
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600">มีบัญชีแล้ว?</p>
                <button id="showLoginBtn" class="text-blue-600 hover:text-blue-800 font-medium mt-2">
                    เข้าสู่ระบบ
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="gradient-bg text-white p-4 sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-car text-2xl"></i>
                    <div>
                        <h1 class="text-lg font-semibold">Car Management</h1>
                        <p class="text-sm opacity-90" id="userInfo">ยินดีต้อนรับ</p>
                    </div>
                </div>
                <button id="logoutBtn" class="p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b border-gray-200 sticky top-16 z-40">
            <div class="flex overflow-x-auto">
                <button class="nav-btn active px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 border-blue-500 text-blue-600" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt mr-2"></i>หน้าหลัก
                </button>
                <button class="nav-btn px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="fuel">
                    <i class="fas fa-gas-pump mr-2"></i>เติมน้ำมัน
                </button>
                <button class="nav-btn px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="maintenance">
                    <i class="fas fa-wrench mr-2"></i>บำรุงรักษา
                </button>
                <button class="nav-btn px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="expenses">
                    <i class="fas fa-chart-line mr-2"></i>ค่าใช้จ่าย
                </button>
                <button class="nav-btn px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="users">
                    <i class="fas fa-users mr-2"></i>ผู้ใช้
                </button>
                <button class="nav-btn px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="settings">
                    <i class="fas fa-cog mr-2"></i>ตั้งค่า
                </button>
            </div>
        </nav>

        <!-- Content -->
        <main class="p-4 pb-20">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <!-- Car Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">รถยนต์ทั้งหมด</h3>
                            <i class="fas fa-car text-blue-500 text-2xl"></i>
                        </div>
                        <p class="text-3xl font-bold text-blue-600" id="totalCars">2</p>
                        <p class="text-sm text-gray-500 mt-1">คันที่ใช้งาน</p>
                    </div>
                    
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">ค่าใช้จ่ายเดือนนี้</h3>
                            <i class="fas fa-money-bill-wave text-green-500 text-2xl"></i>
                        </div>
                        <p class="text-3xl font-bold text-green-600" id="monthlyExpense">12,450</p>
                        <p class="text-sm text-gray-500 mt-1">บาท</p>
                    </div>
                    
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">ระยะทางรวม</h3>
                            <i class="fas fa-road text-purple-500 text-2xl"></i>
                        </div>
                        <p class="text-3xl font-bold text-purple-600" id="totalDistance">2,340</p>
                        <p class="text-sm text-gray-500 mt-1">กิโลเมตร</p>
                    </div>
                </div>

                <!-- Car List -->
                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">รายการรถยนต์</h3>
                        <button id="addCarBtn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:shadow-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>เพิ่มรถ
                        </button>
                    </div>
                    
                    <div id="carList" class="space-y-4">
                        <!-- Car items will be populated here -->
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">กิจกรรมล่าสุด</h3>
                    <div id="recentActivities" class="space-y-3">
                        <!-- Activities will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Fuel Tab -->
            <div id="fuel" class="tab-content hidden">
                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">บันทึกการเติมน้ำมัน</h3>
                        <button id="addFuelBtn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                            <i class="fas fa-plus mr-2"></i>เติมน้ำมัน
                        </button>
                    </div>
                    
                    <div id="fuelRecords" class="space-y-4">
                        <!-- Fuel records will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Maintenance Tab -->
            <div id="maintenance" class="tab-content hidden">
                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">การบำรุงรักษา</h3>
                        <button id="addMaintenanceBtn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                            <i class="fas fa-plus mr-2"></i>เพิ่มรายการ
                        </button>
                    </div>
                    
                    <div id="maintenanceRecords" class="space-y-4">
                        <!-- Maintenance records will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Expenses Tab -->
            <div id="expenses" class="tab-content hidden">
                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">สรุปค่าใช้จ่าย</h3>
                    
                    <!-- Expense Chart Placeholder -->
                    <div class="bg-gray-100 rounded-lg p-8 text-center mb-6">
                        <i class="fas fa-chart-pie text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500">กราฟแสดงค่าใช้จ่าย</p>
                    </div>
                    
                    <div id="expenseList" class="space-y-4">
                        <!-- Expense items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users" class="tab-content hidden">
                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">จัดการผู้ใช้</h3>
                        <div class="flex space-x-2">
                            <button id="addUserBtn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                                <i class="fas fa-user-plus mr-2"></i>เพิ่มผู้ใช้
                            </button>
                            <button id="exportUsersBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                <i class="fas fa-download mr-2"></i>ส่งออก
                            </button>
                        </div>
                    </div>
                    
                    <!-- User Stats -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600" id="totalUsers">0</div>
                            <div class="text-sm text-blue-600">ผู้ใช้ทั้งหมด</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600" id="activeUsers">0</div>
                            <div class="text-sm text-green-600">ใช้งานอยู่</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-600" id="adminUsers">0</div>
                            <div class="text-sm text-purple-600">ผู้ดูแลระบบ</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-orange-600" id="driverUsers">0</div>
                            <div class="text-sm text-orange-600">คนขับรถ</div>
                        </div>
                    </div>
                    
                    <!-- Search and Filter -->
                    <div class="flex flex-col md:flex-row gap-4 mb-4">
                        <div class="flex-1">
                            <input type="text" id="userSearch" placeholder="ค้นหาผู้ใช้..." class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <select id="roleFilter" class="px-4 py-2 border border-gray-300 rounded-lg">
                            <option value="">ทุกตำแหน่ง</option>
                            <option value="admin">ผู้ดูแลระบบ</option>
                            <option value="manager">ผู้จัดการ</option>
                            <option value="driver">คนขับรถ</option>
                            <option value="user">ผู้ใช้ทั่วไป</option>
                        </select>
                    </div>
                    
                    <!-- User List -->
                    <div id="usersList" class="space-y-3">
                        <!-- Users will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content hidden">
                <div class="space-y-6">
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">การแจ้งเตือน</h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-800">แจ้งเตือน Telegram</p>
                                    <p class="text-sm text-gray-500">รับการแจ้งเตือนผ่าน Telegram</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" id="telegramNotif">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <div id="telegramSettings" class="hidden">
                                <input type="text" id="telegramToken" placeholder="Bot Token" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3">
                                <input type="text" id="telegramChatId" placeholder="Chat ID" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Google Sheets</h3>
                        <p class="text-sm text-gray-600 mb-4">เชื่อมต่อกับ Google Sheets เพื่อสำรองข้อมูล</p>
                        
                        <div class="space-y-3">
                            <input type="text" id="sheetId" placeholder="Google Sheet ID" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                            <button id="connectSheetBtn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                                เชื่อมต่อ Google Sheets
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Car Modal -->
    <div id="addCarModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">เพิ่มรถยนต์</h3>
                <button id="closeCarModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addCarForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ยี่ห้อ</label>
                    <input type="text" id="carBrand" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="เช่น Toyota">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">รุ่น</label>
                    <input type="text" id="carModel" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="เช่น Camry">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ปี</label>
                    <input type="number" id="carYear" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="2023">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เลขทะเบียน</label>
                    <input type="text" id="carPlate" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="กข 1234">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เลขไมล์ปัจจุบัน</label>
                    <input type="number" id="carMileage" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="50000">
                </div>
                
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-medium">
                    เพิ่มรถยนต์
                </button>
            </form>
        </div>
    </div>

    <!-- Add Fuel Modal -->
    <div id="addFuelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">บันทึกการเติมน้ำมัน</h3>
                <button id="closeFuelModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addFuelForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เลือกรถ</label>
                    <select id="fuelCarSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                        <option value="">เลือกรถยนต์</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">วันที่เติม</label>
                    <input type="date" id="fuelDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ปริมาณน้ำมัน (ลิตร)</label>
                    <input type="number" step="0.01" id="fuelAmount" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="40.50">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ราคารวม (บาท)</label>
                    <input type="number" step="0.01" id="fuelPrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="1500.00">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">สถานีบริการ</label>
                    <input type="text" id="fuelStation" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="PTT สาขา...">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เลขไมล์ปัจจุบัน</label>
                    <input type="number" id="fuelMileage" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="52000">
                </div>
                
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-medium">
                    บันทึกการเติมน้ำมัน
                </button>
            </form>
        </div>
    </div>

    <script>
        // App State
        let currentUser = null;
        let cars = JSON.parse(localStorage.getItem('cars')) || [];
        let fuelRecords = JSON.parse(localStorage.getItem('fuelRecords')) || [];
        let maintenanceRecords = JSON.parse(localStorage.getItem('maintenanceRecords')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];

        // Sample data for demo
        if (cars.length === 0) {
            cars = [
                {
                    id: 1,
                    brand: 'Toyota',
                    model: 'Camry',
                    year: 2020,
                    plate: 'กข 1234',
                    mileage: 52000,
                    startDate: '2020-01-15'
                },
                {
                    id: 2,
                    brand: 'Honda',
                    model: 'Civic',
                    year: 2019,
                    plate: 'คง 5678',
                    mileage: 48000,
                    startDate: '2019-06-20'
                }
            ];
            localStorage.setItem('cars', JSON.stringify(cars));
        }

        // User management
        let users = JSON.parse(localStorage.getItem('users')) || [];

        // Show/Hide auth screens
        document.getElementById('showRegisterBtn').addEventListener('click', function() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        });

        document.getElementById('showLoginBtn').addEventListener('click', function() {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        // Social Login Functions
        function handleSocialLogin(provider, userData) {
            // Check if user already exists
            let existingUser = users.find(u => u.email === userData.email);
            
            if (existingUser) {
                // User exists, log them in
                currentUser = existingUser;
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userInfo').textContent = `${existingUser.fullName} (${getRoleText(existingUser.role)})`;
                
                loadDashboard();
                sendTelegramNotification(`👋 ${existingUser.fullName} เข้าสู่ระบบผ่าน ${provider}`);
            } else {
                // New user, create account
                const newUser = {
                    id: Date.now(),
                    fullName: userData.name,
                    username: userData.email.split('@')[0] + '_' + provider.toLowerCase(),
                    email: userData.email,
                    phone: userData.phone || '',
                    password: 'social_login_' + Date.now(), // Auto-generated password
                    role: 'user',
                    department: '',
                    registeredAt: new Date().toISOString(),
                    isActive: true,
                    loginProvider: provider,
                    socialId: userData.id
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                currentUser = newUser;
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userInfo').textContent = `${newUser.fullName} (${getRoleText(newUser.role)})`;
                
                loadDashboard();
                sendTelegramNotification(`🎉 ผู้ใช้ใหม่สมัครผ่าน ${provider}: ${newUser.fullName}`);
                
                // Show welcome message
                setTimeout(() => {
                    alert(`ยินดีต้อนรับ ${newUser.fullName}!\nบัญชีของคุณถูกสร้างเรียบร้อยแล้ว`);
                }, 500);
            }
        }

        // Google Login Simulation
        document.getElementById('googleLoginBtn').addEventListener('click', function() {
            // In real implementation, this would use Google OAuth
            // For demo purposes, we'll simulate the response
            const mockGoogleUser = {
                id: 'google_' + Date.now(),
                name: 'ผู้ใช้ Google Demo',
                email: 'google.user@gmail.com',
                phone: ''
            };
            
            // Show loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>กำลังเข้าสู่ระบบ...';
            this.disabled = true;
            
            setTimeout(() => {
                handleSocialLogin('Google', mockGoogleUser);
                this.innerHTML = '<svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg><span>เข้าสู่ระบบด้วย Google</span>';
                this.disabled = false;
            }, 1500);
        });

        // LINE Login Simulation
        document.getElementById('lineLoginBtn').addEventListener('click', function() {
            // In real implementation, this would use LINE Login API
            const mockLineUser = {
                id: 'line_' + Date.now(),
                name: 'ผู้ใช้ LINE Demo',
                email: 'line.user@example.com',
                phone: ''
            };
            
            // Show loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>กำลังเข้าสู่ระบบ...';
            this.disabled = true;
            
            setTimeout(() => {
                handleSocialLogin('LINE', mockLineUser);
                this.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg><span>เข้าสู่ระบบด้วย LINE</span>';
                this.disabled = false;
            }, 1500);
        });

        // Google Register
        document.getElementById('googleRegisterBtn').addEventListener('click', function() {
            document.getElementById('googleLoginBtn').click();
        });

        // LINE Register
        document.getElementById('lineRegisterBtn').addEventListener('click', function() {
            document.getElementById('lineLoginBtn').click();
        });

        // Register functionality
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const role = document.getElementById('registerRole').value;
            const department = document.getElementById('department').value;
            
            // Validation
            if (!fullName || !username || !email || !phone || !password || !confirmPassword || !role) {
                alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('รหัสผ่านไม่ตรงกัน');
                return;
            }
            
            if (password.length < 6) {
                alert('รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร');
                return;
            }
            
            // Check if username already exists
            if (users.find(user => user.username === username)) {
                alert('ชื่อผู้ใช้นี้มีอยู่แล้ว');
                return;
            }
            
            // Check if email already exists
            if (users.find(user => user.email === email)) {
                alert('อีเมลนี้มีอยู่แล้ว');
                return;
            }
            
            // Create new user
            const newUser = {
                id: Date.now(),
                fullName,
                username,
                email,
                phone,
                password, // In real app, this should be hashed
                role,
                department,
                registeredAt: new Date().toISOString(),
                isActive: true
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('สมัครสมาชิกสำเร็จ! กรุณาเข้าสู่ระบบ');
            
            // Clear form and switch to login
            this.reset();
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            
            // Pre-fill login username
            document.getElementById('loginUsername').value = username;
        });

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('กรุณากรอกชื่อผู้ใช้และรหัสผ่าน');
                return;
            }
            
            // Find user
            const user = users.find(u => u.username === username && u.password === password && u.isActive);
            
            if (user) {
                currentUser = user;
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userInfo').textContent = `${user.fullName} (${getRoleText(user.role)})`;
                
                loadDashboard();
                
                // Send welcome notification
                sendTelegramNotification(`👋 ${user.fullName} เข้าสู่ระบบแล้ว`);
            } else {
                alert('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('ต้องการออกจากระบบหรือไม่?')) {
                currentUser = null;
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginForm').reset();
                document.getElementById('registerScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        });

        // Tab navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                
                // Update active tab
                document.querySelectorAll('.nav-btn').forEach(b => {
                    b.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    b.classList.add('border-transparent', 'text-gray-500');
                });
                
                this.classList.add('active', 'border-blue-500', 'text-blue-600');
                this.classList.remove('border-transparent', 'text-gray-500');
                
                // Show/hide content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                document.getElementById(tabName).classList.remove('hidden');
                
                // Load specific tab content
                if (tabName === 'fuel') loadFuelRecords();
                if (tabName === 'maintenance') loadMaintenanceRecords();
                if (tabName === 'expenses') loadExpenses();
                if (tabName === 'users') loadUsers();
            });
        });

        // Modal functionality
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        // Add Car Modal
        document.getElementById('addCarBtn').addEventListener('click', () => showModal('addCarModal'));
        document.getElementById('closeCarModal').addEventListener('click', () => hideModal('addCarModal'));

        document.getElementById('addCarForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newCar = {
                id: Date.now(),
                brand: document.getElementById('carBrand').value,
                model: document.getElementById('carModel').value,
                year: parseInt(document.getElementById('carYear').value),
                plate: document.getElementById('carPlate').value,
                mileage: parseInt(document.getElementById('carMileage').value),
                startDate: new Date().toISOString().split('T')[0]
            };
            
            cars.push(newCar);
            localStorage.setItem('cars', JSON.stringify(cars));
            
            hideModal('addCarModal');
            this.reset();
            loadDashboard();
            updateCarSelects();
            
            // Send Telegram notification
            sendTelegramNotification(`🚗 เพิ่มรถใหม่: ${newCar.brand} ${newCar.model} (${newCar.plate})`);
        });

        // Add Fuel Modal
        document.getElementById('addFuelBtn').addEventListener('click', () => {
            updateCarSelects();
            document.getElementById('fuelDate').value = new Date().toISOString().split('T')[0];
            showModal('addFuelModal');
        });
        document.getElementById('closeFuelModal').addEventListener('click', () => hideModal('addFuelModal'));

        document.getElementById('addFuelForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const carId = parseInt(document.getElementById('fuelCarSelect').value);
            const car = cars.find(c => c.id === carId);
            
            const newFuelRecord = {
                id: Date.now(),
                carId: carId,
                carInfo: `${car.brand} ${car.model} (${car.plate})`,
                date: document.getElementById('fuelDate').value,
                amount: parseFloat(document.getElementById('fuelAmount').value),
                price: parseFloat(document.getElementById('fuelPrice').value),
                station: document.getElementById('fuelStation').value,
                mileage: parseInt(document.getElementById('fuelMileage').value)
            };
            
            // Update car mileage
            car.mileage = newFuelRecord.mileage;
            
            fuelRecords.push(newFuelRecord);
            localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
            localStorage.setItem('cars', JSON.stringify(cars));
            
            hideModal('addFuelModal');
            this.reset();
            loadDashboard();
            
            // Calculate fuel efficiency
            const pricePerLiter = newFuelRecord.price / newFuelRecord.amount;
            
            // Send Telegram notification
            sendTelegramNotification(`⛽ เติมน้ำมัน: ${newFuelRecord.carInfo}\n💰 ${newFuelRecord.price} บาท (${newFuelRecord.amount} ลิตร)\n📍 ${newFuelRecord.station}`);
        });

        // Load Dashboard
        function loadDashboard() {
            // Update summary cards
            document.getElementById('totalCars').textContent = cars.length;
            
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthlyFuelExpense = fuelRecords
                .filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate.getMonth() === thisMonth && recordDate.getFullYear() === thisYear;
                })
                .reduce((sum, record) => sum + record.price, 0);
            
            document.getElementById('monthlyExpense').textContent = monthlyFuelExpense.toLocaleString();
            
            const totalDistance = cars.reduce((sum, car) => sum + car.mileage, 0);
            document.getElementById('totalDistance').textContent = totalDistance.toLocaleString();
            
            // Load car list
            loadCarList();
            
            // Load recent activities
            loadRecentActivities();
        }

        function loadCarList() {
            const carList = document.getElementById('carList');
            carList.innerHTML = '';
            
            cars.forEach(car => {
                const carItem = document.createElement('div');
                carItem.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
                carItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center">
                                <i class="fas fa-car text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800">${car.brand} ${car.model}</h4>
                                <p class="text-sm text-gray-500">${car.plate} • ${car.year}</p>
                                <p class="text-sm text-gray-500">${car.mileage.toLocaleString()} กม.</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <button class="text-blue-600 hover:text-blue-800 p-2">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                `;
                carList.appendChild(carItem);
            });
        }

        function loadRecentActivities() {
            const activities = document.getElementById('recentActivities');
            activities.innerHTML = '';
            
            // Combine and sort recent activities
            const recentFuel = fuelRecords.slice(-3).map(record => ({
                type: 'fuel',
                icon: 'fas fa-gas-pump',
                color: 'text-green-600',
                title: `เติมน้ำมัน ${record.carInfo}`,
                subtitle: `${record.amount} ลิตร • ${record.price} บาท`,
                date: record.date
            }));
            
            const allActivities = [...recentFuel].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            allActivities.slice(0, 5).forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
                activityItem.innerHTML = `
                    <div class="flex-shrink-0">
                        <i class="${activity.icon} ${activity.color}"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800">${activity.title}</p>
                        <p class="text-xs text-gray-500">${activity.subtitle}</p>
                    </div>
                    <div class="text-xs text-gray-400">
                        ${formatDate(activity.date)}
                    </div>
                `;
                activities.appendChild(activityItem);
            });
        }

        function loadFuelRecords() {
            const fuelRecordsContainer = document.getElementById('fuelRecords');
            fuelRecordsContainer.innerHTML = '';
            
            fuelRecords.slice().reverse().forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'border border-gray-200 rounded-lg p-4';
                recordItem.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-gray-800">${record.carInfo}</h4>
                        <span class="text-sm text-gray-500">${formatDate(record.date)}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">ปริมาณ:</span>
                            <span class="font-medium">${record.amount} ลิตร</span>
                        </div>
                        <div>
                            <span class="text-gray-500">ราคา:</span>
                            <span class="font-medium">${record.price} บาท</span>
                        </div>
                        <div>
                            <span class="text-gray-500">สถานี:</span>
                            <span class="font-medium">${record.station}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">เลขไมล์:</span>
                            <span class="font-medium">${record.mileage.toLocaleString()} กม.</span>
                        </div>
                    </div>
                `;
                fuelRecordsContainer.appendChild(recordItem);
            });
        }

        function loadMaintenanceRecords() {
            const container = document.getElementById('maintenanceRecords');
            container.innerHTML = '<div class="text-center py-8 text-gray-500">ยังไม่มีข้อมูลการบำรุงรักษา</div>';
        }

        function loadExpenses() {
            const container = document.getElementById('expenseList');
            container.innerHTML = '';
            
            // Calculate expenses by category
            const fuelExpenses = fuelRecords.reduce((sum, record) => sum + record.price, 0);
            
            const expenseCategories = [
                { name: 'ค่าน้ำมัน', amount: fuelExpenses, icon: 'fas fa-gas-pump', color: 'text-green-600' },
                { name: 'ค่าซ่อมบำรุง', amount: 0, icon: 'fas fa-wrench', color: 'text-blue-600' },
                { name: 'ค่าประกัน', amount: 0, icon: 'fas fa-shield-alt', color: 'text-purple-600' },
                { name: 'อื่นๆ', amount: 0, icon: 'fas fa-ellipsis-h', color: 'text-gray-600' }
            ];
            
            expenseCategories.forEach(category => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-4 border border-gray-200 rounded-lg';
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="${category.icon} ${category.color}"></i>
                        <span class="font-medium text-gray-800">${category.name}</span>
                    </div>
                    <span class="font-semibold text-gray-800">${category.amount.toLocaleString()} บาท</span>
                `;
                container.appendChild(item);
            });
        }

        // Utility functions
        function updateCarSelects() {
            const selects = ['fuelCarSelect'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">เลือกรถยนต์</option>';
                cars.forEach(car => {
                    const option = document.createElement('option');
                    option.value = car.id;
                    option.textContent = `${car.brand} ${car.model} (${car.plate})`;
                    select.appendChild(option);
                });
            });
        }

        function getRoleText(role) {
            const roles = {
                'admin': 'ผู้ดูแลระบบ',
                'manager': 'ผู้จัดการ',
                'driver': 'คนขับรถ',
                'user': 'ผู้ใช้ทั่วไป'
            };
            return roles[role] || role;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH');
        }

        // Telegram notification
        function sendTelegramNotification(message) {
            const telegramEnabled = document.getElementById('telegramNotif').checked;
            const token = document.getElementById('telegramToken').value;
            const chatId = document.getElementById('telegramChatId').value;
            
            if (telegramEnabled && token && chatId) {
                // This is a demo - in real implementation, you'd send to Telegram API
                console.log('Telegram notification:', message);
                // fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ chat_id: chatId, text: message })
                // });
            }
        }

        // Settings
        document.getElementById('telegramNotif').addEventListener('change', function() {
            const settings = document.getElementById('telegramSettings');
            if (this.checked) {
                settings.classList.remove('hidden');
            } else {
                settings.classList.add('hidden');
            }
        });

        document.getElementById('connectSheetBtn').addEventListener('click', function() {
            const sheetId = document.getElementById('sheetId').value;
            if (sheetId) {
                alert('การเชื่อมต่อ Google Sheets ต้องใช้ API Key และการตั้งค่าเพิ่มเติม');
                // In real implementation, you'd connect to Google Sheets API
            }
        });

        // User management functions
        function loadUsers() {
            updateUserStats();
            displayUsers();
        }

        function updateUserStats() {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('activeUsers').textContent = users.filter(u => u.isActive).length;
            document.getElementById('adminUsers').textContent = users.filter(u => u.role === 'admin').length;
            document.getElementById('driverUsers').textContent = users.filter(u => u.role === 'driver').length;
        }

        function displayUsers() {
            const usersList = document.getElementById('usersList');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            
            let filteredUsers = users.filter(user => {
                const matchesSearch = user.fullName.toLowerCase().includes(searchTerm) || 
                                    user.username.toLowerCase().includes(searchTerm) ||
                                    user.email.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilter || user.role === roleFilter;
                return matchesSearch && matchesRole;
            });

            usersList.innerHTML = '';
            
            filteredUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
                
                const statusColor = user.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const roleColor = {
                    'admin': 'bg-purple-100 text-purple-800',
                    'manager': 'bg-blue-100 text-blue-800',
                    'driver': 'bg-orange-100 text-orange-800',
                    'user': 'bg-gray-100 text-gray-800'
                };
                
                userItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800">${user.fullName}</h4>
                                <p class="text-sm text-gray-500">@${user.username} • ${user.email}</p>
                                <p class="text-sm text-gray-500">${user.phone} • ${user.department || 'ไม่ระบุแผนก'}</p>
                                <div class="flex space-x-2 mt-2">
                                    <span class="px-2 py-1 text-xs rounded-full ${roleColor[user.role] || 'bg-gray-100 text-gray-800'}">
                                        ${getRoleText(user.role)}
                                    </span>
                                    <span class="px-2 py-1 text-xs rounded-full ${statusColor}">
                                        ${user.isActive ? 'ใช้งานอยู่' : 'ปิดใช้งาน'}
                                    </span>
                                    ${user.loginProvider ? `<span class="px-2 py-1 text-xs rounded-full bg-indigo-100 text-indigo-800">
                                        ${user.loginProvider}
                                    </span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="toggleUserStatus(${user.id})" class="text-${user.isActive ? 'red' : 'green'}-600 hover:text-${user.isActive ? 'red' : 'green'}-800 p-2" title="${user.isActive ? 'ปิดใช้งาน' : 'เปิดใช้งาน'}">
                                <i class="fas fa-${user.isActive ? 'user-slash' : 'user-check'}"></i>
                            </button>
                            <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800 p-2" title="แก้ไข">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800 p-2" title="ลบ">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                usersList.appendChild(userItem);
            });
        }

        function toggleUserStatus(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.isActive = !user.isActive;
                localStorage.setItem('users', JSON.stringify(users));
                displayUsers();
                updateUserStats();
                
                sendTelegramNotification(`👤 ${user.fullName} ${user.isActive ? 'เปิดใช้งาน' : 'ปิดใช้งาน'}แล้ว`);
            }
        }

        function editUser(userId) {
            alert('ฟีเจอร์แก้ไขผู้ใช้จะพัฒนาในเวอร์ชันถัดไป');
        }

        function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user && confirm(`ต้องการลบผู้ใช้ ${user.fullName} หรือไม่?`)) {
                users = users.filter(u => u.id !== userId);
                localStorage.setItem('users', JSON.stringify(users));
                displayUsers();
                updateUserStats();
                
                sendTelegramNotification(`🗑️ ลบผู้ใช้ ${user.fullName} แล้ว`);
            }
        }

        // Search and filter events
        document.getElementById('userSearch').addEventListener('input', displayUsers);
        document.getElementById('roleFilter').addEventListener('change', displayUsers);

        // Export users
        document.getElementById('exportUsersBtn').addEventListener('click', function() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "ชื่อ-นามสกุล,ชื่อผู้ใช้,อีเมล,เบอร์โทร,ตำแหน่ง,แผนก,สถานะ,วันที่สมัคร\n" +
                users.map(user => 
                    `"${user.fullName}","${user.username}","${user.email}","${user.phone}","${getRoleText(user.role)}","${user.department || ''}","${user.isActive ? 'ใช้งานอยู่' : 'ปิดใช้งาน'}","${formatDate(user.registeredAt)}"`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `users_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Initialize app
        updateCarSelects();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964cae20260dd33c',t:'MTc1MzQ1NzIzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
